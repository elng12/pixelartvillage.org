# 像素艺术生成器代码改进与修复清单

本文档汇总当前代码库（React + Vite 版本）的主要问题、改进建议与可执行清单，按优先级分组，便于快速实施与回归验证。

## 范围
- 核心文件：`src/App.jsx`、`src/components/Editor.jsx`、`src/components/ToolSection.jsx`、`src/hooks/useImageProcessor.js`、`src/utils/imageProcessor.js`、`src/components/editor/Preview.jsx`、`src/components/Header.jsx`
- 构建与验证：`package.json` 脚本、预渲染与 SEO 校验脚本

---

## 高优先级（功能正确性/可用性）

1) 上传按钮缺少点击处理器（无效按钮）
- 影响：用户与自动化测试必须点击外层“上传区域”，按钮本身无效。
- 文件：`src/components/ToolSection.jsx`
- 建议：给“Choose File”按钮绑定 `onClick={handleClick}`，与外层一致触发。

2) `Editor` 中错误提示使用 `alert()`（打断式、不可访问）
- 影响：体验与无障碍较差，与 `ToolSection` 的内联错误提示不一致。
- 文件：`src/components/Editor.jsx`
- 建议：改为在界面内联展示错误（`aria-live`），统一错误呈现方式。

3) 预览图 `alt` 文案未走 i18n
- 影响：多语言与可访问性不一致。
- 文件：`src/components/editor/Preview.jsx`
- 建议：从 i18n 取文案（例如 `t('preview.alt')`）。

4) 粘贴上传仅在已进入 `Editor` 后生效
- 影响：首次进入页面、未上传图片时无法通过粘贴上传。
- 文件：`src/components/Editor.jsx`
- 建议：将“全局粘贴导入”监听提升到 `ToolSection` 或更高层（或两处都支持）。

---

## 中优先级（一致性/稳定性/性能）

5) 处理任务防抖阈值硬编码（300ms）
- 影响：在低端设备/大图下可能需要不同的节流策略。
- 文件：`src/hooks/useImageProcessor.js`
- 建议：抽为常量/配置项，例如 `PROCESS_DEBOUNCE_MS`，便于调整与 A/B。

6) 预览/处理尺寸上限策略需在注释中明确
- 现状：上传前预缩放与处理路径都使用 `PREVIEW_LIMIT.maxEdge`，策略总体一致。
- 建议：在相关模块补充注释，确保后续维护者理解“先 contain 限制、再像素化/调色板”的顺序与理由。

7) 对象 URL 清理最后一层兜底
- 现状：`ToolSection` 已在新图加载前 revoke 上一个 URL。
- 建议：在路由切换/页面卸载时（上层）追加一次统一 `revokeObjectURL` 清理。

---

## 体验与可用性（低/中优先级）

8) 拖拽上传缺少明确的“拖入中”视觉态
- 文件：`src/components/ToolSection.jsx`
- 建议：在 `dragover` 时添加更显著的高亮态与提示文本。

9) 像素网格/像素大小等用户偏好未持久化
- 文件：`src/components/Editor.jsx`
- 建议：使用 `localStorage` 记忆 `showGrid`、`pixelSize` 等，提升回访体验。

10) 预览尺寸徽章文本未 i18n
- 文件：`src/components/editor/Preview.jsx`
- 建议：尺寸信息旁的单位/格式字符串也从字典读取。

---

## SEO、构建与回归验证

11) 保持构建后 SEO 验证为必经步骤
- 现状：`postbuild` 已运行 `seo-check.js`，`scripts/verify-dist-entries.cjs` 亦可验证关键资源。
- 建议：将 `npm run verify:dist` 纳入 CI 必跑流程，阻断回退。

12) 预渲染与多语言规范化
- 现状：主页与多语言路由已通过预渲染输出；`hreflang` 与 `canonical` 已设置。
- 建议：每次路由结构调整后，复核 `generate-sitemap` 与 `hreflang` 的一致性。

---

## 建议实现示例（摘要）

### A. 让上传按钮可点击（ToolSection）
```jsx
// src/components/ToolSection.jsx（给按钮加 onClick）
<button type="button" className="btn-primary" data-testid="choose-file-btn" onClick={handleClick}>
  {t('tool.chooseFile')}
</button>
```

### B. 将 alert 改为内联错误（Editor）
```jsx
// 将 alert(...) 替换为设置本地错误状态，并在 UI 中渲染（aria-live="polite"）
// 参考 ToolSection 的错误渲染方式，保持一致。
```

### C. 预览 alt 走 i18n（Preview）
```jsx
// src/components/editor/Preview.jsx
// const { t } = useTranslation()
<img alt={t('preview.alt')} ... />
```

### D. 粘贴上传的覆盖范围
```jsx
// 将 window 粘贴监听同步添加到 ToolSection；
// 或者在 App 层集中处理粘贴，分发给当前激活的上传入口。
```

---

## 待办清单（按优先级）

- [ ] 高：上传按钮绑定 `onClick={handleClick}`（ToolSection）
- [ ] 高：Editor 的错误提示改为内联（替换 alert）
- [ ] 高：Preview 的 `alt` 文案走 i18n
- [ ] 高：粘贴上传提升到 ToolSection/全局，覆盖“初次进入”
- [ ] 中：`PROCESS_DEBOUNCE_MS` 常量化（useImageProcessor）
- [ ] 中：完善尺寸上限策略注释（上传前预缩放与处理路径）
- [ ] 中：路由卸载时统一 revoke 对象 URL
- [ ] 低：拖拽上传高亮态与提示
- [ ] 低：记忆像素网格/像素大小等偏好（localStorage）
- [ ] 低：预览尺寸徽章文本 i18n 化
- [ ] CI：`npm run verify:dist` 纳入必跑

---

## 备注
- 当前核心图像处理链路（`useImageProcessor` → `processPixelArt`）设计良好：
  - 有防抖与中断（AbortController）
  - 先限尺寸 contain → 再像素化/调色板
  - 导出路径优先复用源 canvas，缺失时回退 dataURL
- 本文档列出的修改不会改变处理算法输出，仅提升可用性、一致性与可维护性。


